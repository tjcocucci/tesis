\chapter{Conclusiones}

En este trabajo damos un marco teórico general para asimilación de datos y presentamos las metodologías más populares, con especial énfasis en métodos basados en ensambles como el EnKF y el filtro de partículas. Luego, presentamos el problema de la especificación de errores en este tipo sistemas, mostrando como afectan en la performance y comentando estrategias útiles para tratar con estas incertezas. Uno de los objetivos de mi doctorado es el de desarrollar técnicas de estimación de estos errores con interés particular en metodologías secuenciales y basadas en el algoritmo EM. A modo de avance en esta dirección desarrollamos lo que constituye una de las contribuciones principales del trabajo que integra esta tesis: una metodología \textit{online} de estimación del error de modelo y observacional basada en el EM junto con una evaluación experimental de su desempeño en escenarios de interés para el área. Tiene la propiedad de acoplarse a técnicas de asimilación de datos por ensamble modernas como el EnKF o el VMPF. Otro de los objetivos de la tesis es la utilización de metodologías de este tipo sobre modelos epidemiológicos. Por lo tanto también realizamos experimentos de aplicación del EM \textit{online} para un modelo compartimental simple de COVID-19 utilizando tanto datos sintéticos como reales. Previo a esto presentamos los modelos epidemiológicos compartimentales clásicos así como los antecedentes de inferencia sobre estos, haciendo énfasis en los trabajos que utilizan técnicas de asimilación de datos. El creciente interés en modelos basados en agentes nos motivó a extender parte de nuestro trabajo de investigación a este tipo de modelado. Otra de las contribuciones más relevantes de este trabajo es la de un marco general de aplicación de técnicas de asimilación de datos por ensambles en modelos basados en agentes. Tomamos como ejemplo de aplicación un modelo para COVID-19 y evaluamos experimentalmente la metodología.

El algoritmo EM \textit{online} que desarrollamos mostró resultados satisfactorios en los escenarios en los que fue evaluado. La versión que se acopla al EnKF con un paso de suavizado de EnKS tiene una menor complejidad computacional que el EM \textit{offline} acoplado al EnKS (\cite{Pulido2018}). Además tiene la propiedad de que puede capturar cambios temporales lentos en los parámetros e incluso recuperar la estructura de covarianzas de las matrices que parametrizan los errores. La performance del método sin embargo depende de la elección de la tasa de aprendizaje. Esta cuantifica cuanta importancia se le da a la observación que está siendo procesada en comparación a la estimación previa. El problema es similar a los de la elección de una tasa de aprendizaje para métodos de descenso de gradiente en machine learning. Por lo tanto, una posible línea de investigación es buscar incluir en el EM \textit{online} una tasa de aprendizaje adaptativa del tipo momentum, ADAGRAD o ADADELTA \citep{Zeiler2012} o ADAM \citep{Kingma2014}. Estos métodos se adaptan de manera dinámica a la tarea de optimización y pueden mejorar dramáticamente la convergencia. Creemos que la maximización de la verosimilitud mediante EM puede ser reinterpretada como un método de gradientes lo que permitiría utilizar la vasta caja de herramientas provista en gran parte por el desarrollo moderno de métodos de machine learning. En particular es muy posible que este enfoque permita una reinterpretación similar para los métodos \textit{online}.

Otro desafío pendiente para nuestro algoritmo es el de su desempeño en sistemas de alta dimensionalidad. El problema de la asimilación de datos en alta dimensionalidad atrae gran interés debido a que muchos modelos geofísicos consideran grillas espaciales que queden alcanzar las $10^9$ dimensiones. Las representaciones de distribuciones mediante muestras en altas dimensiones se deteriora debido a la maldición de la dimensionalidad. El EnKF y el VMPF mitigan en parte el problema porque hace un uso más eficiente de las partículas pero por ejemplo la evaluación de pesos en un filtro de partículas como el filtro bootstrap en altas dimensiones se vuelve problemática porque la evaluación de la verosimilitud da valores demasiado próximos a cero. Por estos motivos, la evaluación del EM \textit{online} en espacios de gran dimensionalidad constituye una línea de investigación interesante. En particular, resulta relevante estudiar el desempeño de la metodología en combinación con las estrategias clásicas de asimilación de datos para paliar algunos de estos problemas, tales como la inflación y la localización.

Otras posibles extensiones del EM \textit{online} involucran la combinación de la metodología con filtros de Kalman por ensambles más sofisticados. Por simplicidad nosotros usamos el filtro estocástico \citep{Burgers1998}, sin embargo existe una familia vasta de filtros por ensambles con los que evaluar la técnica. De manera similar, a pesar de que usamos el algoritmo en combinación con un filtro de partículas moderno (el VMPF), la variedad de filtros de partículas es muy amplia y sería valioso estudiar como se desempeña el EM \textit{online} en este espectro de métodos. Por otro lado, la implementación del algoritmo con un paso de suavizado hacia atrás sugiere la posibilidad de una implementación que realiza un suavizado de varios pasos temporales hacia atrás. Esta variación entonces involucra una ventana móvil de manera que el suavizado hacia atrás tiene una interpretación que se denomina \textit{fixed-lagged smoother} \citep{Cosme2012}. Estas ventanas se superpondrían, tal como en una implementación de media móvil pero también existe la posibilidad de considerar ventanas yuxtapuestas en las que se corre el algoritmo EM \textit{batch} clásico, es decir una suerte de implementación con \textit{mini-batchs}. Una adaptación extra que vale la pena considerar es la utilización del EM \textit{online} son distribuciones no Gaussianas. La metodología considera distribuciones de la familia exponencial y en el caso Gaussiano se tiene la ventaja de que la solución que anula al gradiente de la ELBO se puede computar de manera explícita y esto puede no ser el caso para otras distribuciones.

La aplicación del EM \textit{online} a modelos epidemiológicos compartimentales, en nuestro conocimiento, no se ha hecho antes. De hecho existen pocos antecedentes de estimación de errores en modelos epidemiológicos siendo una excepción el trabajo de \cite{Ionides2006} en el que se usan filtros iterados. Sin embargo esta técnica aumenta el estado con parámetros estocásticos lo cual no suele dar buenos resultados según \cite{Delsole2010}. Los resultados muestran que la metodología del EM \textit{online} es aplicable a modelos epidemiológicos compartimentales incluso incorporando el método de estado aumentado para parámetros del modelo con variación temporal. Notamos que cuando se utiliza estado aumentado con caminatas aleatorias, el ruido que estas incorporan al sistema afecta sobre las estimaciones del error observacional y del sistema en general. En particular, si el ruido introducido es muy grande se puede llegar a un exceso de confianza sobre la calidad de las observaciones y por lo tanto a un sobreajuste. Esto se debe a que la estocasticidad de las caminatas aleatorias actúa como error de modelo y si este es muy grande, los pronósticos que produce el modelo pierden credibilidad. Para dar cuenta de esta situación existen algunas alternativas. Por un lado se pueden interpretar a las varianzas de las distribuciones de las caminatas como parte de una matriz $\v Q$ que parametrice el error de todo el modelo y estimar con el EM \textit{online} a esta matriz. Por otro lado es posible utilizar métodos de inflación de ensamble adaptativos \citep{Ruiz2013b}.

Otra observación que se debe hacer respecto a la aplicación del EnKF en sistemas epidemiológicos tiene que ver con que las variables son definidas positivas. Esto no es muy problemático cuando los valores que toman las variables están lejos del cero puesto que las incertezas Gaussianas pueden ser apropiadas. Sin embargo, cerca del cero las distribuciones Gaussianas pueden resultar inexactas y dar lugar a valores negativos sin interpretación epidemiológica en el sistema. Este problema se extiende también a la asimilación con EnKF en ABMs. Una posible solución al problema es la utilización de filtros de Kalman que admiten restricciones lineales como que las variables sean positivas o que la suma de los compartimentos de igual al total de la población \citep{Gupta2007}. Por otro lado también existen versiones del EnKF adaptadas para variables definidas positivas utilizando distribuciones Gamma o Gamma inversa \citep{Bishop2016}.

La utilización de asimilación de datos por ensambles en ABMs mostró ser factible en su aplicación a un modelo epidemiológico sencillo. Los experimentos muestran que la metodología permitió estimar correctamente las variables macroscópicas del sistema junto con parámetros epidemiológicos de interés como la cantidad de contactos diarios o la proporción de casos no reportados. A pesar de que \cite{Ward2016} también plantea la combinación de ABMs con el EnKF no se hace referencia en ese trabaja a como debería modificarse la población de agentes para ser consistente a las correcciones del EnKF sobre el estado macroscópico. Nosotros planteamos dos maneras de hacer esto para el caso particular de nuestro modelo epidemiológico pero creemos que algunas de las ideas subyacentes, sobretodo del método de redistribución aleatorizada, pueden generalizarse a una gama más amplia de ABMs. La utilización de metodologías de esta naturaleza sobre modelos más complejos es un problema que hasta donde conocemos no ha sido explorado pero que podría dar resultados interesantes. Esto se debe a que la inferencia sobre ABMs y su calibración es importante para que este tipo de modelos puedan ser mejorar su desempeño y para facilitar su uso en sistemas operacionales de predicción. En este sentido, los modelos dinámicos de ecuaciones diferenciales han sido mucho más estudiados y existen muchas más herramientas de inferencia para estos.

Nuestra metodología se basa en asimilar datos en espacio de las variables macroscópicas que también son en general las variables observadas. Sin embargo es posible pensar en asimilar datos al nivel microscópico. Para esto podemos considerar a todos los atributos de los agentes como el estado oculto del modelo de Markov escondido pero esto trae algunos inconvenientes que deben ser resueltos. Por un lado los atributos de los agentes pueden pertenecer a espacios en los que no se puede aplicar el EnKF de manera directa, por ejemplo si los atributos son números enteros o etiquetas no queda claro como utilizar el EnKF porque este está diseñado para valores reales. Por otro lado, muchos de los atributos pueden no estar correlacionados a las observaciones. Además de esto, la cantidad de atributos puede ser muy grande, mucho más que el de las variables agregadas y por otro lado, la distribución de los atributos no es necesariamente Gaussiana lo que potencialmente degrada el desempeño del EnKF. Asimilar datos a este nivel habilitaría también el uso de observaciones a nivel micro. De hecho, los datos individualizados son cada vez más comunes por el uso de dispositivos personales y el monitoreo de actividad en internet. Este enfoque permitiría una combinación potencialmente fructífera entre este tipo de datos y los ABMs. 

Una de las características del esquema que propusimos para asimilar datos en ABMs es que las poblaciones de agentes se corrigen para ser consistentes con las variables del macroestado. Esta modificación en los atributos de agentes puede tener consecuencias difíciles de pronosticar. Una alternativa que evitaría estos cambios podría ser la de utilizar un filtro de partículas \textit{bootstrap}. Este filtro, para construir la muestra del análisis, toma la muestra del pronóstico remuestrea las partículas de acuerdo a cuán verosímil hacen a la observación. Esto significa que las poblaciones de agentes no necesitan ser modificadas en absoluto, simplemente se remuestrea el ensamble y se conservan como análisis las poblaciones de agentes seleccionadas (con las repeticiones correspondientes provenientes del remuestreo si las hubiera). Es necesario remarcar que el hecho de que el filtro de partículas \textit{bootstrap} reutilice las partículas del pronóstico para construir el análisis, es conveniente para la aplicación con ABMs pero no es una característica deseable en general puesto que da lugar a la llamada pérdida de la diversidad. De hecho, filtros de partículas más modernos usan algún tipo de mutación o \textit{jittering} para evitar que existan partículas repetidas y que se mantenga la diversidad para una mejor representación de las distribuciones. De utilizar algún tipo de mutación, en la aplicación con ABMs, se debería entonces intervenir sobre los atributos de los agentes. Pensamos entonces que la combinación de ABMs con distintas herramientas de las que dispone la asimilación de datos puede dar lugar interacciones fructíferas.

Finalmente, resta investigar el efecto de los errores observacionales y de modelo en ABMs y en particular en sistemas combinados con asimilación de datos. Es posible pensar en la introducción de modelo aditivo o mediante inflación sobre las macrovariables y luego, mediante alguna corrección como las que propusimos en la Sección \ref{sec:agents_adjustment} dar cuenta de esos cambios sobre la población de agentes. Otra opción sería introducir error directamente sobre los atributos de los agentes aunque no queda claro que utilizar distribuciones Gaussianas se adecuado en este caso. De hecho, sobre  atributos que no son números reales se debe considerar otra alternativa. En cuanto al error observacional sobre las variables macroscópicas se tiene, al igual que en los modelos compartimentales, que al ser las variables definidas positivas. El error en este tipo de variables tiende a depender de la magnitud de la variable en sí por lo que para estimarla sería adecuado utilizar algún método adaptativo como el EM \textit{online}. La estimación de incertezas en ABMs es un área poco estudiada pero de importancia, sobre todo en contextos en los que se quiere hacer inferencia. 

