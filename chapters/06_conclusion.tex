\chapter{Conclusiones} \label{chp:conclusion}

En este trabajo nos propusimos estudiar el tratamiento de errores en sistemas de asimilación de datos, sobretodo con técnicas basadas en ensambles, para luego explorar las posiblidades de aplicar metodologías de este tipo en sistemas epidemiológicos. Para esto dimos un marco teórico general de la asimilación de datos como problema de inferencia Bayesiana en modelos de Markov escondidos y proporcionamos un panorama de las técnicas más populares, dando especial atención a los filtros de partículas y los filtros de Kalman por ensambles. Luego presentamos el problema de la especificación de errores observacionales y de modelo y su impacto en la performance en sistemas de asimilación de datos. Mencionamos algunas de las estrategias que se han propuesto para la estimación de estas incertezas y nos focalizamos en el algoritmo EM. En este punto exponemos el desarrollo de lo que constituye una de las contribuciones principales del trabajo: una metodología \textit{online} de estimación del error de modelo y observacional basada en el EM junto con una evaluación experimental de su desempeño en escenarios de interés para el área. Tiene la propiedad de acoplarse a técnicas de asimilación de datos por ensamble modernas como el EnKF o de filtros de partículas como el VMPF. También realizamos experimentos de aplicación del EM \textit{online} para un modelo epidemiológico compartimental simple de COVID-19 utilizando tanto datos sintéticos como reales. Previo a esto presentamos los modelos epidemiológicos compartimentales clásicos así como los antecedentes de inferencia sobre éstos, haciendo énfasis en los trabajos que utilizan técnicas de asimilación de datos. El creciente interés en modelos basados en agentes nos motivó a extender la aplicación de asimilación de datos a este tipo de modelado. En este sentido, otra de las contribuciones más relevantes de este trabajo es la de un marco general de aplicación de técnicas de asimilación de datos por ensambles en modelos basados en agentes. Trabajamos sobre un modelo para COVID-19 y evaluamos experimentalmente la metodología en este contexto, sin embargo la estrategia tiene la generalidad suficiente como para ser aplicable a otros tipos de modelos basados en agentes.

El algoritmo EM \textit{online} que desarrollamos mostró resultados satisfactorios en los escenarios en los que fue evaluado. La versión que se acopla al EnKF con un paso de suavizado de EnKS tiene una menor complejidad computacional que el EM \textit{offline} acoplado al EnKS (\cite{Pulido2018}). Además tiene la propiedad de que puede capturar cambios temporales lentos en los parámetros e incluso recuperar la estructura de covarianzas de las matrices que parametrizan los errores. La performance del método sin embargo depende de la elección de la tasa de aprendizaje. Esta cuantifica cuanta importancia se le da a la observación que está siendo procesada en comparación a la estimación previa. El problema es similar a los de la elección de una tasa de aprendizaje para métodos de descenso de gradiente en \textit{machine learning}. Por lo tanto, una posible línea de investigación es buscar incluir en el EM \textit{online} una tasa de aprendizaje adaptativa del tipo momentum, ADAGRAD, ADADELTA o ADAM \citep{Zeiler2012, Kingma2014}. Estos métodos se adaptan de manera dinámica a la tarea de optimización y pueden mejorar dramáticamente la convergencia. Creemos que la maximización de la verosimilitud mediante EM puede ser reinterpretada como un método de gradientes lo que permitiría utilizar la vasta caja de herramientas provista en gran parte por el desarrollo moderno de métodos de \textit{machine learning}. En particular, es muy posible que este enfoque permita una reinterpretación similar para los métodos \textit{online}.

Otro desafío de interés para futuros trabajos es la extensión de la metodología a sistemas de alta dimensionalidad. El problema de la asimilación de datos en alta dimensionalidad atrae gran interés debido a que muchos modelos geofísicos consideran grillas espaciales que queden alcanzar las $10^9$ dimensiones. Las representaciones de distribuciones mediante muestras en altas dimensiones se deteriora debido a la maldición de la dimensionalidad. El EnKF y el VMPF mitigan en parte el problema porque hacen un uso más eficiente de las partículas. Pero, por ejemplo, la evaluación de pesos en un filtro de partículas como el filtro bootstrap en altas dimensiones se vuelve problemática porque la evaluación de la verosimilitud da valores demasiado próximos a cero. Por estos motivos, la utilización del EM \textit{online} en espacios de gran dimensionalidad constituye una línea de investigación interesante. En particular, resulta relevante estudiar el desempeño de la metodología en combinación con las estrategias clásicas de asimilación de datos para paliar algunos de estos problemas: por ejemplo, la inflación y la localización. Por otro lado se requiere de propuestas de parametrización de la covarianza ya que no es posible representarla explícitamente en espacios de alta dimensionalidad.

Otras posibles extensiones del EM \textit{online} involucran la combinación de la metodología con filtros de Kalman por ensambles más sofisticados. Por simplicidad nosotros usamos el filtro estocástico \citep{Burgers1998}, sin embargo existe una familia vasta de filtros por ensambles con los que evaluar la técnica. De manera similar, a pesar de que usamos el algoritmo en combinación con un filtro de partículas moderno (el VMPF), la variedad de filtros de partículas es muy amplia y sería valioso estudiar como se desempeña el EM \textit{online} en este espectro de métodos. Por otro lado, la implementación del algoritmo con un paso de suavizado hacia atrás sugiere la posibilidad de una implementación que realice un suavizado de varios pasos temporales hacia atrás. Esta variación involucraría una ventana móvil, de manera que el suavizado hacia atrás tiene una interpretación que se denomina \textit{fixed-lagged smoother} \citep{Cosme2012}. Estas ventanas se superpondrían, tal como en una implementación de media móvil pero también existe la posibilidad de considerar ventanas yuxtapuestas en las que se corre el algoritmo EM \textit{batch} clásico, es decir una suerte de implementación con \textit{mini-batchs}. Una adaptación extra que vale la pena considerar es la utilización del EM \textit{online} con distribuciones no Gaussianas. La metodología considera distribuciones de la familia exponencial y en el caso Gaussiano se tiene la ventaja de que la solución que anula al gradiente de la ELBO se puede computar de manera explícita pero esto puede no ser el caso para otras distribuciones.

La aplicación del EM \textit{online} a modelos epidemiológicos compartimentales, en nuestro conocimiento, no se ha hecho antes. De hecho existen pocos antecedentes de estimación de errores en modelos epidemiológicos siendo una excepción el trabajo de \cite{Ionides2006} en el que se usan filtros iterados. Sin embargo, en este trabajo se aumenta el estado con parámetros estocásticos lo cual no garantiza buenas estimaciones (según \cite{Delsole2010}). Los resultados muestran que la metodología del EM \textit{online} es aplicable a modelos epidemiológicos compartimentales incluso incorporando el método de estado aumentado para parámetros del modelo con variación temporal. Notamos que cuando se utiliza estado aumentado con caminatas aleatorias, el ruido que estas incorporan al sistema afecta sobre las estimaciones del error observacional y del sistema en general. En particular, si el ruido introducido es muy grande se puede llegar a un exceso de confianza sobre la calidad de las observaciones y por lo tanto a un sobreajuste. Esto se debe a que la estocasticidad de las caminatas aleatorias actúa como error de modelo y si este es muy grande, los pronósticos que produce el modelo pierden credibilidad. Para dar cuenta de esta situación existen algunas alternativas. Por un lado se pueden interpretar a las varianzas de las distribuciones de las caminatas como parte de una matriz $\v Q$ que parametrice el error de todo el modelo y estimar con el EM \textit{online} a esta matriz. Por otro lado es posible utilizar métodos de inflación de ensamble adaptativos \citep{Ruiz2013b}.

Otra observación que se debe hacer respecto a la aplicación del EnKF en sistemas epidemiológicos tiene que ver con que las variables son definidas positivas. Esto no es muy problemático cuando los valores que toman las variables están lejos del cero puesto que las incertezas Gaussianas pueden ser apropiadas. Sin embargo, cerca del cero las distribuciones Gaussianas pueden resultar inexactas y dar lugar a valores negativos sin interpretación epidemiológica en el sistema. Este problema se extiende también a la asimilación con EnKF en ABMs. Una posible solución al problema es la utilización de filtros de Kalman que admiten restricciones lineales, como que las variables sean positivas o que la suma de los compartimentos de igual al total de la población \citep{Gupta2007}. Por otro lado también existen versiones del EnKF adaptadas para variables definidas positivas utilizando distribuciones Gamma o Gamma inversa \citep{Bishop2016}.

La utilización de asimilación de datos por ensambles en ABMs mostró ser factible en su aplicación a un modelo epidemiológico sencillo. Los experimentos muestran que la metodología permitió estimar correctamente las variables macroscópicas del sistema junto con parámetros epidemiológicos de interés, como la cantidad de contactos diarios o la proporción de casos no reportados. A pesar de que \cite{Ward2016} también plantea la combinación de ABMs con el EnKF, no se hace referencia en ese trabajo a como debería modificarse la población de agentes para ser consistente a las correcciones del EnKF sobre el estado macroscópico. Nosotros planteamos dos maneras de hacer esto para el caso particular de nuestro modelo epidemiológico pero creemos que algunas de las ideas subyacentes, sobretodo del método de redistribución aleatorizada, pueden generalizarse a una gama más amplia de ABMs. La utilización de metodologías de esta naturaleza sobre modelos más complejos es un problema que hasta donde conocemos no ha sido explorado pero que podría dar resultados interesantes. Esto se debe a que la inferencia sobre ABMs y su calibración es importante para que este tipo de modelos puedan mejorar su desempeño y para facilitar su uso en sistemas operacionales de predicción. En este sentido, los modelos dinámicos de ecuaciones diferenciales han sido mucho más estudiados por lo que existen actualmente muchas más herramientas de inferencia diseñadas y evaluadas para este tipo de modelo.

Nuestra metodología se basa en asimilar datos en el espacio de las variables macroscópicas que también son en general las variables observadas. Sin embargo es posible pensar en asimilar datos al nivel microscópico. Para esto podemos considerar a todos los atributos de los agentes como el estado oculto del modelo de Markov escondido pero esto trae algunos inconvenientes que deben ser resueltos. Por un lado, los atributos de los agentes pueden pertenecer a espacios en los que no se puede aplicar el EnKF de manera directa. Por ejemplo si los atributos son números enteros o etiquetas no queda claro como utilizar el EnKF porque este está diseñado para valores reales. Por otro lado, muchos de los atributos pueden no estar correlacionados a las observaciones. Además de esto, la cantidad de atributos puede ser muy grande, mucho más que el de las variables agregadas y por otro lado, la distribución de los atributos no es necesariamente Gaussiana lo que potencialmente degrada el desempeño del EnKF. Asimilar datos a este nivel habilitaría también el uso de observaciones a nivel micro. De hecho, los datos individualizados son cada vez más comunes por el uso de dispositivos personales y el monitoreo de actividad en internet. Este enfoque permitiría una combinación potencialmente fructífera entre este tipo de datos y los ABMs. 

Una de las características del esquema que propusimos para asimilar datos en ABMs es que las poblaciones de agentes se corrigen para ser consistentes con las variables del macroestado. Esta modificación en los atributos de agentes puede tener consecuencias difíciles de pronosticar. Una alternativa que evitaría estos cambios podría ser la de utilizar un filtro de partículas \textit{bootstrap}. Este filtro, para construir la muestra del análisis, toma la muestra del pronóstico y remuestrea las partículas de acuerdo a cuán verosímil hacen a la observación. Esto significa que las poblaciones de agentes no necesitan ser modificadas en absoluto, simplemente se remuestrea el ensamble y se conservan como análisis las poblaciones de agentes seleccionadas, con las repeticiones correspondientes provenientes del remuestreo si las hubiera. Es necesario remarcar que el hecho de que el filtro \textit{bootstrap} reutilice las partículas del pronóstico para construir el análisis, es conveniente para la aplicación con ABMs pero no es una característica deseable en general puesto que da lugar a la llamada pérdida de la diversidad. De hecho, filtros de partículas más modernos usan algún tipo de mutación o \textit{jittering} para evitar que existan partículas repetidas y que se mantenga la diversidad para una mejor representación de las distribuciones. De utilizar algún tipo de mutación, en la aplicación con ABMs, se debería entonces intervenir sobre los atributos de los agentes. Concluímos que la combinación de ABMs con otras herramientas de las que dispone la asimilación de datos puede dar lugar interacciones fructíferas y vadría la pena explorar estas posibilidades.

Finalmente, resta investigar el efecto de los errores observacionales y de modelo en ABMs y en particular en sistemas combinados con asimilación de datos. Es posible pensar en la introducción de modelo aditivo o mediante inflación sobre las macrovariables y luego, mediante alguna corrección como las que propusimos en la Sección \ref{sec:agents_adjustment} dar cuenta de esos cambios sobre la población de agentes. Otra opción sería introducir error directamente sobre los atributos de los agentes aunque no queda claro que utilizar distribuciones Gaussianas sea adecuado en este caso. De hecho, sobre  atributos que no son números reales se debe considerar otra alternativa. En cuanto al error observacional sobre las variables macroscópicas se tiene, al igual que en los modelos compartimentales, que las variables son definidas positivas. Como mencionamos antes esto puede causar problemas para el EnKF. El error en este tipo de variables tiende a depender de la magnitud de la variable en sí por lo que para estimarla sería adecuado utilizar algún método adaptativo como el EM \textit{online}. La estimación de incertezas en ABMs es un área poco estudiada pero es un tema que deberá ser atendido para que los ABMs se consoliden como herramientas para el modelado e inferencia de sistemas complejos.
